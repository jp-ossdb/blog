<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan CSS Support - PaaS OSS Database Blog</title>
  
  <subtitle>日本マイクロソフト Azure Database for PostgreSQL / MySQL / MariaDB サポート情報ブログ</subtitle>
  <link href="https://jp-ossdb.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jp-ossdb.github.io/blog/"/>
  <updated>2026-01-13T22:14:59.336Z</updated>
  <id>https://jp-ossdb.github.io/blog/</id>
  
  <author>
    <name>Azure PaaS OSS Database Support Japan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Azure Database for PostgreSQL / MySQL フレキシブル サーバーのバースト可能コンピュートについて</title>
    <link href="https://jp-ossdb.github.io/blog/oss/burstable/"/>
    <id>https://jp-ossdb.github.io/blog/oss/burstable/</id>
    <published>2026-01-13T15:00:00.000Z</published>
    <updated>2026-01-13T22:14:59.336Z</updated>
    
    <content type="html"><![CDATA[<p>この記事は、Azure Database for PostgreSQL / MySQL フレキシブル サーバーの バースト可能コンピュート（Burstable）サイズ をお使いの際に、予期しない性能低下や接続不可、サーバー操作失敗などの事象に悩まれている方に向けた内容です。バースト可能コンピュートがどのような前提で設計されているか、メトリックの見え方、実際の現場で起きているパターン、そして「どのような用途なら選んでよいか」「どの用途には向かないか」を整理してお伝えすることを意図しています。 </p><p>※この記事の内容は、記事を公開した時点での情報となり、今後のアップデートで変更がある場合もございますことをご了承ください。最新の情報についてはお気軽にお問い合わせください。</p><h2 id="バースト可能は、CPU-クレジット型の-VM"><a href="#バースト可能は、CPU-クレジット型の-VM" class="headerlink" title="バースト可能は、CPU クレジット型の VM"></a>バースト可能は、CPU クレジット型の VM</h2><p>まず前提として、Azure Database for PostgreSQL / MySQL フレキシブル サーバーは、内部的には Azure Virtual Machines (VM) の上で動作する PaaS サービスです。<br>コンピューティングレベルで選択する SKU（B1ms / B2s / B2ms など）は、そのまま基盤となる VM のサイズを意味します。<br>そのため、「バースト可能コンピュート」の挙動を理解するためには、まず バースタブル VM（Bv1 シリーズ）側の CPU クレジットモデル を押さえておく必要があります。</p><p>バースト可能（バースタブル）VM は、「いつもフルパワーは要らないが、ときどきだけ CPU を大きく使いたい」という前提で設計されたコンピュートモデルです。現在、Azure Database for PostgreSQL / MySQL フレキシブル サーバーのバースト可能コンピュートで利用される VM は Bv1 シリーズ (B1ms / B2s / B2ms など) に該当します。これらの B 系列 VM は CPU クレジットモデルを採用しており、CPU 使用率がベースラインを下回っているあいだはクレジットが貯まり、その後ベースラインを超えて CPU を使うときに、その貯まったクレジットを消費しながら一時的に100%までバーストできる仕組みになっています。<br>重要なポイントは、クレジットを使い切ってしまうと、CPU はベースライン相当までしか動けなくなる という点です。たとえば vCPU が 1 コアでベースライン 20% のサイズであれば、クレジットがゼロの状態では、常に 0.2 コア分程度の計算力 しか出せません。見かけ上は CPU 使用率メトリックが 100% 付近に張り付き続けても、それはフル 1 コアの 100% ではなく、ベースライン 0.2 コアを使い切って頭打ちになっている 100% という状態になり得ます。</p><p>よくある誤解として、「バースト可能は負荷が増えたら自動的にコア数（vCPU 数）が増えるのではないか」という質問がありますが、実際は、クレジットモデルで変化するのは 1 コア当たりの利用可能な時間（パフォーマンス） であり、vCPU の数そのものは増えません。より多くの CPU リソースが恒常的に必要な場合は、上位の SKU や vCPU 数の多いサイズへスケールアップする必要があります。 </p><p>また、同じ Bv1 シリーズの中でも B1ms / B2s / B2ms など SKU ごとに、ベースラインの CPU パーセンテージ、初期クレジット量、クレジットの蓄積速度が異なります。これらの具体的な数値は Azure Virtual Machines の Bv1 シリーズのサイズ のドキュメントに一覧化されており、ページ上部のタブを切り替えることで各サイズの詳細（ベースライン、クレジットレートなど）を確認できます。</p><p>Azure Virtual Machines Bv1 シリーズ<br><a href="https://learn.microsoft.com/azure/virtual-machines/sizes/general-purpose/bv1-series">https://learn.microsoft.com/azure/virtual-machines/sizes/general-purpose/bv1-series</a></p><h2 id="Azure-Database-for-PostgreSQL-MySQL-フレキシブル-サーバーにおける「バースト可能コンピュート」"><a href="#Azure-Database-for-PostgreSQL-MySQL-フレキシブル-サーバーにおける「バースト可能コンピュート」" class="headerlink" title="Azure Database for PostgreSQL / MySQL フレキシブル サーバーにおける「バースト可能コンピュート」"></a>Azure Database for PostgreSQL / MySQL フレキシブル サーバーにおける「バースト可能コンピュート」</h2><p>例えば、Azure Database for PostgreSQL フレキシブル サーバーには、バースト可能 (Burstable)、汎用 (General Purpose)、メモリ最適化 (Memory Optimized) の 3 種類のコンピューティングレベルがあります。公開情報では、バースト可能コンピュートレベルについて、低コストの開発 と、継続的なコンピューティング容量を必要としない低コンカレンシーのワークロード に最適であると明記されています。一方で、高いコンカレンシーや予測可能なパフォーマンスが必要な運用環境のワークロード には、汎用などの上位レベルが推奨されています。 <br></p><p>Azure Database for MySQL フレキシブル サーバーでも、基盤の VM は同じ Bv1 シリーズであることから考え方は同様です。バースト可能コンピュートレベルは、本番環境ではなく、継続的な最大 CPU を必要としない軽いワークロード の場合や、開発 / テストなどの環境でコストを抑えたい場合 に適した構成として説明されています。一方で、クレジットが枯渇した場合には CPU 性能が制限され、最悪の場合は接続不可やサーバー操作への影響が出る ことは、PostgreSQL / MySQL で共通の注意点です。 <br><br>つまり、Azure Database for PostgreSQL / MySQL フレキシブル サーバーのバースト可能コンピュート は、元になっている Bv1 バースタブル VM と同じく 「軽い・一時的なワークロード」向け であり、「本番業務システム」や「本番と同等負荷のパフォーマンス テスト」 のような用途は前提としていません。 <br></p><h2 id="メトリックの見え方と、よくある誤解"><a href="#メトリックの見え方と、よくある誤解" class="headerlink" title="メトリックの見え方と、よくある誤解"></a>メトリックの見え方と、よくある誤解</h2><p>バースト可能コンピュートを使うときに混乱が起きやすいポイントが、CPU 関連メトリックの解釈 です。 <br><br>例えば、Azure Database for MySQL フレキシブル サーバーの Host CPU Percent メトリックの値は、ベースラインではなく 「フル vCPU に対する割合」 を表しています。たとえばベースライン 40% のサイズで Host CPU Percent が 50% と表示されている場合、「50% × 40% = 実効 20%」という意味ではなく、「1 コア分の 50% を使っている ＝ すでにベースライン 40% を超えてクレジットを消費し始めている」という状態になります。 <br><br>クレジットがゼロになった場合でも、メトリック上は 100% と表示され続けますが、その時点では ベースライン相当の性能を使い切っている 100% であり、CPU をさらに増やすことはできません。その結果として、クエリが遅くなったり、接続や管理操作がタイムアウトしやすくなったりします。 <br><br>このため、バースト可能コンピュートレベルを利用する場合は、Host CPU Percent だけでなく、CPU Credits Remainings のメトリックも合わせて監視 し、クレジットが減り続けてゼロに近づいていないかを確認することがとても重要です。 <br></p><h2 id="現場で実際に起きているパターン"><a href="#現場で実際に起きているパターン" class="headerlink" title="現場で実際に起きているパターン"></a>現場で実際に起きているパターン</h2><p>サポート現場で実際に相談を受けている、よくある事例を典型的なパターンとして整理します。</p><p>あるお客様では、B1ms や B2s といった非常に小さいバースト可能 SKU を使って、開発と本番をまとめて運用されていました。最初のうちは CPU 使用率も 20〜30% 程度で問題なく動いていましたが、年々本番データや処理が増える につれて、CPU 使用率が 20% を超える時間帯が増え、クレジットが少しずつ削られていきました。ある時点からは、ほぼ常時 80〜100% の高い CPU 使用率になり、いったんクレジットが枯渇すると、その後はワークロードが落ち着いてもクレジットが再構築されず、サーバーの停止・起動・再起動などの操作さえ時間がかかる、あるいは失敗する 状況になってしまいました。このケースでは、お客様と協議のうえ、そのサーバーを実質的に本番として扱うのであれば、General Purpose などの上位レベルにスケールアップする ことをご提案し、最終的にアップグレードを選択されました。</p><p>別のお客様では、開発環境としてバースト可能コンピュート を選択し、毎朝サーバーを起動して業務終了後に停止する、という運用でコスト削減を図っていました。しかし、ある日からポータル上で「停止中」の状態のまま変わらず、サーバーが停止できない、あるいは再起動操作が完了しない という事象が発生しました。調査の結果、そのサーバーも小さなバースト可能 SKU で、通常のアプリケーション負荷に加えて、サービス内部のメンテナンス処理やログ関連処理によって CPU クレジットが使い切られ、サーバー内部のリソースが逼迫した ことで、管理操作そのものに影響が出ていたことが分かりました。このように、バースタブルでは サーバーを小さくし過ぎると、アプリ側の負荷が少なくても、内部のコンポーネントだけでクレジットが消費されてしまう ことがあります。</p><p>また、別の開発環境では、1 分あたり百数回程度のトランザクション（BEGIN〜COMMIT の単位）が継続 している状態で、アプリからはほとんどクエリを投げていないはずなのに、Total Transactions が多すぎるのではないかと疑問を持たれたパターンもございます。実際には、Azure Database for PostgreSQL フレキシブル サーバー側で行っているヘルスチェックやメトリック収集などのシステム処理も含めてトランザクション数が計測 されており、B1ms のような小さいサイズでは、これら内部処理だけでもクレジット消費に影響し得ることが確認されています。</p><h2 id="バースト可能レベルの機能制限"><a href="#バースト可能レベルの機能制限" class="headerlink" title="バースト可能レベルの機能制限"></a>バースト可能レベルの機能制限</h2><p>さらに、バースト可能コンピュートレベルでは 一部の機能制限 も存在します。Azure Database for PostgreSQL フレキシブル サーバーでは、組み込みの PgBouncer 接続プール機能 は、汎用またはメモリ最適化レベルでのみサポート されており、バースト可能レベルにスケールダウンすると PgBouncer が利用できなくなります。PgBouncer に依存している構成では、そもそもバースト可能レベルを選択できないという制約があります。また、Azure Database for PostgreSQL / MySQL フレキシブル サーバーともに、高可用性構成はバースト可能コンピュートレベルでは利用できません。本番システムでは、設計段階でバースト可能を選択肢から外すべきポイントとなります。</p><h2 id="ワークロードによっては動作が安定しないのに、なぜ存在するのか？"><a href="#ワークロードによっては動作が安定しないのに、なぜ存在するのか？" class="headerlink" title="ワークロードによっては動作が安定しないのに、なぜ存在するのか？"></a>ワークロードによっては動作が安定しないのに、なぜ存在するのか？</h2><p>サポートで実際にいただく率直なご質問として、「ワークロードによって動作が安定しない可能性があるのに、なぜバースト可能という SKU が存在するのか」というものがあります。</p><p>背景としては、主に次のようなニーズがあります。</p><p>・気軽に低価格でクラウドを触り始めたい<br>・まずは小さな検証環境を安く動かしたい</p><p>これらのニーズに応えるため、クレジット型のバースト可能 VM を基盤とする低価格なコンピュート を提供しているという側面があります。比較的安価な VM やデータベースを提供することで、初めてクラウドを利用するお客様や、小さな開発・検証用途のお客様の選択肢を広げたい という意図があります。<br>一方で、「安価な SKU を提供すること」と「どんな本番ワークロードにも適していると誤解されないこと」 のバランスが非常に難しいのも事実です。Azure Database for PostgreSQL / MySQL フレキシブル サーバーともに、バースト可能レベルは 、低コストの開発や低コンカレンシーなワークロード向け」 であり、「高いコンカレンシーや予測可能なパフォーマンスが必要な運用環境のワークロードでは汎用などの上位レベルを推奨しております。<br>しかし、ポータルの UI 表示や価格の差だけを見ると、「安いし、うちの業務もそこまで重くないから大丈夫だろう」と判断されることが多いのが、日々のサポートの中で感じている実情です。</p><p>弊社開発側でも、小さな SKU で起きている内部コンポーネントの負荷やログ関連処理の最適化など、品質向上のための改善を継続していますが、CPU クレジットという仕組み上、「クレジットを使い切ると性能が制限される」こと自体をなくすことは仕様としてできません。そのため、バースト可能コンピュートは、あくまで 用途を絞って使っていただく前提のお試し的な SKU である、という理解を持っていただくことが重要になります。<br>特に、何か期限が迫っていたり、多くのワークロードが求められるケース においては、バースト可能コンピュートは適していないと考えます。</p><h2 id="どんな用途ならバースト可能コンピュートを選んでよいか"><a href="#どんな用途ならバースト可能コンピュートを選んでよいか" class="headerlink" title="どんな用途ならバースト可能コンピュートを選んでよいか"></a>どんな用途ならバースト可能コンピュートを選んでよいか</h2><p>バースト可能コンピュートが有効に機能するのは、次のような性質を持つワークロードです。</p><p>・日中はほとんどアクセスがなく、開発者が時々ログインして軽く操作する程度の 開発用・検証用データベース<br>・PoC や個人検証のために、軽いデータを扱う 小規模アプリケーション<br>・夜間や決まった時間にだけ重くないバッチ処理を行い、それ以外の時間はほぼアイドルに近い 検証環境</p><p>こういったケースでは、通常はベースライン以下で動きつつ、時々のピーク時にクレジットを使ってバーストする という設計思想とマッチすると考えます。<br>逆に、次のような性質のワークロードでは、バースト可能コンピュートレベルの設計思想と適していないことから、基本的に選ぶべきではない と考えます。</p><p>・業務時間帯を通して常にトランザクションが流れ続ける 基幹システム<br>・1 日の多くの時間帯で CPU 使用率が 20〜40% を超えている 本番データベース<br>・利用者が増えたりデータ量が増えたりしても、一定以上の応答性能を維持することが必須の 外部向けサービス<br>・PgBouncer などの接続プール機能を前提としており、多数の接続をさばく必要がある 高コンカレンシー構成<br>・特定の期日までに完了させる必要のある、軽くない 検証・負荷試験環境</p><p>こういったシステムは、クレジットの有無に関係なく、そもそも汎用やメモリ最適化レベルでの運用を前提に設計することが適しています。</p><h2 id="バースト可能コンピュートをすでに使っている場合に、確認すべきポイント"><a href="#バースト可能コンピュートをすでに使っている場合に、確認すべきポイント" class="headerlink" title="バースト可能コンピュートをすでに使っている場合に、確認すべきポイント"></a>バースト可能コンピュートをすでに使っている場合に、確認すべきポイント</h2><p>もしすでにバースト可能コンピュートレベルで Azure Database for PostgreSQL / MySQL フレキシブル サーバーを運用している場合は、次のような観点で状況を確認していただくとよいと思います。</p><p>・コンピューティングレベルが バースト可能 で、SKU が B1ms / B2s といった小さいサイズになっていないかどうか<br>・監視メトリックで Host CPU Percent が 50〜80% 以上の時間帯が長く続いていないか どうか<br>・CPU Credits Remaining が、時間の経過とともに減り続けてゼロ付近をうろうろしていないかどうか<br>・クレジットがゼロの状態で Host CPU Percent が 100% に張り付き続けるようであれば、すでに ベースライン性能を使い切っている証拠 と考えます。</p><p>こうした状況が確認できる場合、短期的には 高負荷処理を一時的に完全に止めてクレジットの蓄積を待つ という対処もありますが、本番環境では現実的ではないことが多いです。<br>根本的には、次のような構成変更が必要になることが、今まで対応してきたケースにおける共通した根本対処となります。</p><p>・コンピュートレベルの見直し（汎用などの上位レベルへ）<br>・vCPU 数の増加（SKU のスケールアップ）<br>・本番と開発・検証を別サーバーに分ける</p><p>最後に、お使いの中でご不明点等ございましたら、この記事の内容に重複する部分であっても、お気軽にサポートリクエストをご起票いただけますと幸いです。<br>弊チームが最後までサポートいたします。</p><h2 id="参考情報（VM-PostgreSQL-MySQL）"><a href="#参考情報（VM-PostgreSQL-MySQL）" class="headerlink" title="参考情報（VM / PostgreSQL / MySQL）"></a>参考情報（VM / PostgreSQL / MySQL）</h2><p>最後に、本記事の内容とあわせてお客様にご参照いただきたい公開情報の URL を記載します。</p><p>Azure Virtual Machines Bv1 シリーズ<br><a href="https://learn.microsoft.com/azure/virtual-machines/sizes/general-purpose/bv1-series">https://learn.microsoft.com/azure/virtual-machines/sizes/general-purpose/bv1-series</a> <br><br>Azure Database for PostgreSQL フレキシブル サーバーのコンピューティング オプション（バースト可能の詳細）<br><a href="https://learn.microsoft.com/ja-jp/azure/postgresql/configure-maintain/concepts-compute">https://learn.microsoft.com/ja-jp/azure/postgresql/configure-maintain/concepts-compute</a>  <br><br>Azure Database for MySQL フレキシブル サーバーのサービス レベルとストレージ（バースト可能の詳細）<br><a href="https://learn.microsoft.com/ja-jp/azure/mysql/flexible-server/concepts-service-tiers-storage">https://learn.microsoft.com/ja-jp/azure/mysql/flexible-server/concepts-service-tiers-storage</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;この記事は、Azure Database for PostgreSQL / MySQL フレキシブル サーバーの バースト可能コンピュート（Burstable）サイズ をお使いの際に、予期しない性能低下や接続不可、サーバー操作失敗などの事象に悩まれている方に向けた内容です。</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Azure OSS PaaS サービスのサポート範囲について（PostgreSQL, MySQL, Citus） </title>
    <link href="https://jp-ossdb.github.io/blog/oss/supportboundary/"/>
    <id>https://jp-ossdb.github.io/blog/oss/supportboundary/</id>
    <published>2025-04-30T15:00:00.000Z</published>
    <updated>2026-01-13T22:14:59.336Z</updated>
    
    <content type="html"><![CDATA[<p> </p><p>こんにちは。Azure OSS サポートチームです。  <br><br>今回の投稿では、Azure Database for PostgreSQL Flexible Server、Azure Database for MySQL Flexible Server、Azure Cosmos DB for PostgreSQL に関連するサポート範囲について、オープンソースソフトウェア（OSS）としての側面を踏まえながらご案内いたします。 <br><br>お客様から多くいただく質問をベースに、すべてのお客様に対して公平かつ安定したサポートを提供するため、サポート範囲を明確にご説明します。</p><br><h2 id="OSS-ベースの-Azure-PaaS-サービスについて"><a href="#OSS-ベースの-Azure-PaaS-サービスについて" class="headerlink" title="OSS ベースの Azure PaaS サービスについて"></a>OSS ベースの Azure PaaS サービスについて</h2><p>まず、下記のサービスは、弊チームが担当している製品であり、いずれもオープンソースソフトウェア（OSS）をベースに構築されたPaaS のマネージドサービスです。 </p><p>・Azure Database for PostgreSQL Flexible Server <br><br>・Azure Database for MySQL Flexible Server <br><br>・Azure Cosmos DB for PostgreSQL  </p><p>一方、PostgreSQL や MySQL、Citus といった OSS 自体は、弊社製品ではございません。そのため、OSS 自体の仕様や挙動(例：SQL 構文の動作、オプティマイザの挙動、組み込み関数の仕様など) に関するご質問は、サポート範囲外となっております。また、Azure サポートでは各サービスに対して専任のチームが存在し、たとえば、Azure Virtual Machines や Storage に関するご質問は、それぞれの専門チームのみが対応しております。同様に、OSS 自体の仕様や挙動に関するご質問も、OSSの性質上、いかなる専任チームも存在しないため、Azure サポート全体として正式なサポート対象には含まれておりません。  </p><p>PostgreSQL、MySQL、Citus をはじめとする OSS は、ソースコードがGitHub上で公開されており、全ての方が自由に使用・開発に参加できるという特性を持っています。一方で、 OSS のライセンスにおいては、利用による不具合や結果に対して提供元が責任を負わないことが明記されています (AS IS条文)。</p><br><h2 id="AS-IS-条文"><a href="#AS-IS-条文" class="headerlink" title="[AS IS 条文]"></a>[AS IS 条文]</h2><p> <br>・Citus OSSから抜粋 <br><br>“THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.” <br><br><a href="https://github.com/citusdata/citus/blob/main/LICENSE">Citus AS IS</a></p><p> <br>・MySQLから抜粋 <br><br>“BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW. EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU. SHOULD THE PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING, REPAIROR CORRECTION.” <br><br><a href="https://github.com/mysql/mysql-server/blob/trunk/LICENSE">MySQL AS IS</a></p><p> <br>・PostgreSQLから抜粋 <br><br>“THE UNIVERSITY OF CALIFORNIA SPECIFICALLY DISCLAIMS ANY WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE SOFTWARE PROVIDED HEREUNDER IS ON AN “AS IS” BASIS, AND THE UNIVERSITY OF CALIFORNIA HAS NO OBLIGATIONS TO PROVIDE MAINTENANCE, SUPPORT, UPDATES, ENHANCEMENTS, OR MODIFICATIONS.” <br><br><a href="https://github.com/marcoalbarelli/PostgreSQL/blob/master/LICENSE">PostgreSQL AS IS</a></p><p>例えば、弊社は、Citus OSS の開発に関与している一方、それは Citus OSS コミュニティに対する貢献であり、Citus に限らず OSS の開発には全ての人が参加できる性質から、Citus OSS の仕様や動作に関して、弊社が全ての責任を負うものではございません。上記の AS IS 条文に相当する記載は、Citus に限らずその他の OSS においても共通のものとなります。</p><p>従って、OSS 自体へのご質問につきましては、回答をお約束するものではありませんが、ご参考情報としてご案内を差し上げることが可能な場合がございます。その場合は、調査・回答にはお時間をいただく必要があり、またその内容についての正確性・完全性は弊社は保証いたしかねますことを、あらかじめご了承いただけますと幸いです。</p><br><h2 id="サポート範囲に含まれる内容について"><a href="#サポート範囲に含まれる内容について" class="headerlink" title="サポート範囲に含まれる内容について"></a>サポート範囲に含まれる内容について</h2><p> <br>・サーバー起動や停止に関する問題（例. サーバーが正常に起動しない、停止操作が反映されない等々）  <br><br>→ Azure がインフラ管理を行っており、起動/停止はマネージドサービスの範囲です。</p><p> <br>・接続関連の問題（例. ポータル経由での接続エラー、認証情報の設定エラー等々） <br> <br>→ 接続管理は Azure 環境下で設定されるため、Azure サポート対象です。 <br><br>※弊チームはDB側の調査を行うことが可能ですが、例として、AKSから独自のDNS、ロードバランサーなど経由してAzure Database for PostgreSQL flexible serverへなど複雑なシナリオでは、クライアントやネットワーク製品の基盤部の調査であれば、別チームの対応が必要となります。また、クライアント接続設定やネットワークリソースの設定であればお客様対応範囲となります。また、異なる例として、例えばパスワードエラーであることをこちらから回答することは可能ですが、正しいパスワードをクライアントのどの箇所にどのように入れれば良いかの回答はサポート契約内で行うことができません。</p><p> <br>・ネットワーク設定関連（例. VNet 統合やファイアウォール設定の問題等々） <br><br>→ ネットワークやファイアウォール設定は、Azure マネージド機能として提供されています。 <br><br>※弊チームはDB側の調査を行うことが可能ですが、例として、AKSから独自のDNS、ロードバランサーなど経由してAzure Database for PostgreSQL flexible serverへなど複雑なシナリオでは、クライアントやネットワーク製品の基盤部の調査であれば、別チームの対応が必要となります。また、クライアント接続設定やネットワークリソースの設定であればお客様対応範囲となります。また、異なる例として、例えばパスワードエラーであることをこちらから回答することは可能ですが、正しいパスワードをクライアントのどの箇所にどのように入れれば良いかの回答はサポート契約内で行うことができません。</p><p> <br>・リソース逼迫の要因調査（例. リソース使用率が高い等々） <br> <br>→ リソースやパフォーマンスの高騰の要因がAzure側にて何か被疑箇所があるか調査可能です。 <br><br>※上記の問題の切り分けの結果、アプリケーションからのワークロードを要因と判明した場合、その要因であるワークロードの軽減策の案内は、サポート契約内で行うことはできません。</p><p> <br>・I/O 性能に関する問題（例. ディスクスループットが低下、書き込み速度が遅い等々） <br><br>→ ストレージ性能は Azure インフラに依存するため、サポート対象です。 <br><br>※上記の問題の切り分けの結果、アプリケーションからのワークロードを要因と判明した場合、その要因であるワークロードの軽減策の案内は、サポート契約内で行うことはできません。 <br> </p><p>・リソース管理に関する問題（例. CPU やメモリ使用率が異常に高い等々）  <br><br>→ リソース管理は、Azure のマネージド機能として対応可能です。 <br><br>※上記の問題の切り分けの結果、アプリケーションからのワークロードを要因と判明した場合、その要因であるワークロードの軽減策の案内は、サポート契約内で行うことはできません。 <br> </p><p>・バックアップやリストア操作のエラー（例. 自動バックアップが失敗、PITR ができない等々） <br><br>→ バックアップ機能は Azure 側で管理されているため、サポート対象です。 <br> </p><p>・データ復旧操作のサポート（例. ポイントインタイムリストアが完了しない等々）  <br><br>→ Azure マネージドサービスとしてバックアップとリストアが提供されているためです。 <br> </p><p>・スケーリング操作に関する問題（例. サーバーサイズ変更が反映されない等々）  <br><br>→ スケーリング操作は、Azure ポータルや CLI から実施され、Azure 管理下にあります。 <br> </p><p>・高可用性（HA）関連の問題（例. フェイルオーバーが発生しない、HA 構成が反映されない等々） <br><br>→ Azure が管理する HA 機能であるため、サポート対象です。 <br> </p><p>・パラメータ設定の適用エラー（例. 設定変更が反映されない、再起動後に失敗等々）  <br><br>→ パラメータ管理はマネージドサービス範囲です。 <br> </p><p>・ノードの追加や削除が反映されない（例. クラスター構成の変更が反映されない等々）  <br><br>→ クラスター管理は Azure のマネージド機能であるため、対応可能です。 <br> </p><p>・クエリパフォーマンス監視ができない（例. モニタリングツールのデータが取得できない等々）  <br><br>→ Azure Monitor との統合部分はサポート対象です。 <br> </p><br><h2 id="サポート範囲に含まれない内容について"><a href="#サポート範囲に含まれない内容について" class="headerlink" title="サポート範囲に含まれない内容について"></a>サポート範囲に含まれない内容について</h2><p>・クエリオプティマイザの挙動に関する質問（例. 特定のクエリでインデックスが利用されない理由を知りたい等々）  <br><br>→ クエリオプティマイザの動作は、PostgreSQL OSS 自体の設計仕様に依存しているため、Azure 側で制御できる部分ではないためサポート対象外です。 <br> </p><p>・拡張モジュールやプラグインの不具合に関する質問（例. pg_stat_statements が特定環境で正しく動作しない、本番環境で MySQL プラグインがクラッシュする等々） <br><br>→ 拡張モジュールやプラグイン自体は OSS 部分であり、Microsoft が直接管理・保証しているわけではないためサポート対象外です。 <br> </p><p>・内部エンジンの動作に関する技術的質問（例. VACUUM 処理中のメモリ使用量が多い理由を知りたい等々）  <br><br>→ VACUUM やオートバキュームは、PostgreSQL OSS の内部アルゴリズムに依存し、Azure 側で制御しているわけではないためサポート対象外です。 <br> </p><p>・SQL 構文に関する仕様解釈の質問（例. 特定のクエリで意図した結果が得られない等々）  <br><br>→ SQL の仕様や挙動は、PostgreSQL OSS 自体の標準機能であり、Azure が設計や実装を管理しているわけではないためサポート対象外です。 <br> </p><p>・InnoDB ストレージエンジンの内部挙動に関する質問（例. InnoDB が特定条件で遅くなる理由を知りたい等々）  <br><br>→ InnoDB の挙動は、MySQL OSS 自体の仕様に依存しており、Azure 側が制御している部分ではないためサポート対象外です。 <br> </p><p>・バージョンアップに伴う非互換性に関する質問（例. MySQL 5.7 から 8.0 に移行した際に動作が変わった等々） <br><br>→ バージョンアップによる仕様変更は OSS 側で管理されているため、Azure サービスとしての制御範囲外です。 <br> </p><p>・SQL チューニングに関する詳細な技術サポート（例. 特定クエリのパフォーマンスが低下する原因を調査してほしい等々）  <br><br>→ クエリチューニング自体は OSS 側の性能最適化の問題であり、Azure サービスの範囲外です。 <br> </p><p>・Citus 特有の関数や演算子に関する仕様解釈（例. 特定の集計クエリが分散環境で動作しない等々）  <br><br>→ Citus OSS の拡張機能はオープンソースとして提供されているため、Azure が直接管理している部分ではないためサポート対象外です。 <br> </p><p>・Citus OSS バージョン固有のバグに関する質問（例. GitHub に報告されている Citus の既知バグについて詳細を教えてほしい等々）  <br><br>→ GitHub 上で報告されたバグはOSS コミュニティで解決されるべき問題であり、Azure サポートが直接対応できる範囲外です。 <br> </p><p>・SQL 処理におけるパーティショニング問題（例. 特定のパーティションテーブルでクエリが遅い等々）  <br><br>→ 分散処理やパーティショニングの挙動は Citus OSS のアルゴリズムに依存し、Azure 側で制御する範囲外です。 <br> </p><br><h2 id="適切な問い合わせ先について-OSS-に関する公式サポートリソース"><a href="#適切な問い合わせ先について-OSS-に関する公式サポートリソース" class="headerlink" title="適切な問い合わせ先について(OSS に関する公式サポートリソース)"></a>適切な問い合わせ先について(OSS に関する公式サポートリソース)</h2><p> <br>このご案内は、 OSS の性質および弊社サポートの提供範囲を明確にすることで、全てのお客様に対して公平で安定したサポートを提供するためのものです。 <br><br>ご理解のほどよろしくお願い申し上げます。 <br><br>OSS に関する正式で詳細な技術サポートをご希望の場合は、以下が適切なリソースとなりますため、ご検討いただけますと幸いです。</p><p>• <a href="https://www.postgresql.org/support/">PostgreSQL コミュニティ</a> <br><br>• <a href="https://dev.mysql.com/support/">MySQL コミュニティ</a> <br><br>• <a href="https://www.citusdata.com/support/">Citus OSS</a> </p><br><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p> <br>Azure サービスとして提供されている部分については、Microsoft が責任を持ってサポートいたします。 <br><br>一方、OSS の仕様や動作に関するご質問についてはサポート範囲外となります。  <br><br>これらの点を正しくご理解いただき、適切なサポートリソースをご活用いただけますと幸いです。  <br><br>引き続き、Azure サービスのご利用にあたりご不明な点がございましたら、サポートまでお問い合わせください。</p><br>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt; &lt;/p&gt;
&lt;p&gt;こんにちは。Azure OSS サポートチームです。  &lt;br&gt;&lt;br&gt;今回の投稿では、Azure Database for PostgreSQL Flexible Server、Azure Database for MySQL Flexible Serv</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Azure Database for PostgreSQL フレキシブルサーバー の メンテナンスについて</title>
    <link href="https://jp-ossdb.github.io/blog/postgres-flexible/azure-database-for-postgresql-flexibleserver-planned-maintenance/"/>
    <id>https://jp-ossdb.github.io/blog/postgres-flexible/azure-database-for-postgresql-flexibleserver-planned-maintenance/</id>
    <published>2023-05-29T15:00:00.000Z</published>
    <updated>2026-01-13T22:14:59.336Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、日本マイクロソフト サポートの岡本です。</p><p>本記事では Azure Database for PostgreSQL フレキシブルサーバー の 予定メンテナンスについて、メンテナンスの説明および影響と推奨事項を記載しております。<br>なお、本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p><br><h2 id="予定メンテナンスとは"><a href="#予定メンテナンスとは" class="headerlink" title="予定メンテナンスとは"></a>予定メンテナンスとは</h2><p>Azure Database for PostgreSQL フレキシブルサーバーでは、管理対象のデータベースを安全で安定した最新状態に保持するために定期的なメンテナンスが実行されます。<br>メンテナンス中に、サーバーでは新しい機能、更新プログラム、パッチが取得されます。</p><p>メンテナンス、並びにフェールオーバーの動作に関しましては、長期間のシステムダウンを防ぎながら、Azure 基盤の状態を最新に保つため必要な動作でございます。</p><br><h2 id="メンテナンスによる影響"><a href="#メンテナンスによる影響" class="headerlink" title="メンテナンスによる影響"></a>メンテナンスによる影響</h2><p>メンテナンスの適用によりフェールオーバーをトリガーした場合、Azure Database for PostgreSQL フレキシブルサーバーで利用されているデータベースサーバーの切り替え（ ＝内部的なフェールオーバー ）が自動的に実施されます。<br>この際、実行中の処理は中断され、トランザクションはロールバックされ、全ての既存の接続に瞬断が発生し切り替わりの間は新規接続も失敗いたします。<br>短時間で接続可能な状態になることが想定されておりますが、フェールオーバー発生時のトランザクション状況により、接続可能になるまでに時間を要する場合がございます。</p><p>そのため、対象の Azure Database for PostgreSQL フレキシブルサーバー への一時的な接続問題とメンテナンス期間が重なっている場合はメンテナンスによって発生したフェールオーバーによって接続断が発生したと判断することが可能です。</p><br><h2 id="推奨事項"><a href="#推奨事項" class="headerlink" title="推奨事項"></a>推奨事項</h2><ul><li>メンテナンス期間を指定する</li></ul><p>予定メンテナンスではカスタムスケジュールを設定することでメンテナンス期間を選択することができます。<br>メンテナンス期間を選択することで、ワークロード多い時間帯を避けることで予定メンテナンスによる影響を小さくすることができます。</p><p>下記のリンクでは、メンテナンススケジュールの設定方法及びイベントの通知に関してご案内がございますので、併せてご活用ください。<br><a href="https://learn.microsoft.com/ja-jp/azure/postgresql/flexible-server/how-to-maintenance-portal">Azure Database for PostgreSQL の予定メンテナンス設定の管理 - フレキシブル サーバー</a></p><br><ul><li>一時的なエラーを対応するために再試行ロジックを実装する</li></ul><p>Azure Database for PostgreSQL フレキシブルサーバー のような PaaS のデータベースをご利用される場合、メンテナンスなどによるフェールオーバー発生時の一時的な接続断の対策として、アプリケーション側で接続を再試行するためのリトライロジックを実装いただくことを推奨しております。</p><p>下記のリンクではリトライロジックを実装する際の再試行回数や間隔等の情報について言及していますので、併せてご確認ください。<br><a href="https://learn.microsoft.com/ja-jp/azure/architecture/best-practices/transient-faults">一時的な障害の処理 - Best practices for cloud applications</a></p><p>リンク先は Azure Database for PostgreSQL シングルサーバーを対象としておりますが、Azure Database for PostgreSQL フレキシブルサーバーも同様にお考えいただけますと幸いです。<br><a href="https://learn.microsoft.com/ja-jp/azure/postgresql/single-server/concepts-connectivity">Azure Database for PostgreSQL - Singlser Server の一時的な接続エラーに対処する</a></p><br><p>上記内容がお役に立ちましたら幸いです。</p><br>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、日本マイクロソフト サポートの岡本です。&lt;/p&gt;
&lt;p&gt;本記事では Azure Database for PostgreSQL フレキシブルサーバー の 予定メンテナンスについて、メンテナンスの説明および影響と推奨事項を記載しております。&lt;br&gt;なお、本情報の内</summary>
      
    
    
    
    
    <category term="PostgreSQL" scheme="https://jp-ossdb.github.io/blog/tags/PostgreSQL/"/>
    
  </entry>
  
  <entry>
    <title>An existing connection forcibly closed by the remote host について</title>
    <link href="https://jp-ossdb.github.io/blog/postgres-single/troubleshoot-postgresql-an-existing-connection-was-forcibly/"/>
    <id>https://jp-ossdb.github.io/blog/postgres-single/troubleshoot-postgresql-an-existing-connection-was-forcibly/</id>
    <published>2022-12-24T03:00:00.000Z</published>
    <updated>2026-01-13T22:14:59.336Z</updated>
    
    <content type="html"><![CDATA[<p>※本記事は <a href="https://techcommunity.microsoft.com/t5/azure-database-for-postgresql/troubleshoot-postgresql-an-existing-connection-was-forcibly/ba-p/925164">Troubleshoot PostgreSQL: ‘An existing connection was forcibly closed by the remote host’</a> の抄訳となります。</p><p>PostgreSQLのログに “could not receive data from client. “のようなエラーが表示された後、すぐに次のようなエラーが発生します。</p><blockquote><p>‘An existing connection was forcibly closed by the remote host’ </p></blockquote><p>この2つのエラーは相互に関連しており、クライアント側の接続処理の問題と関連していることがよくあります。</p><p>このようなタイプのエラーは、さまざまなコンポーネントが関与しているため、残念ながらトラブルシューティングが難しい場合があります。<br>このブログ記事では、このエラーが発生する原因と、それを回避するためのベストプラクティスについて説明します。</p><h2 id="既に無効になった接続"><a href="#既に無効になった接続" class="headerlink" title="既に無効になった接続"></a>既に無効になった接続</h2><p>クライアントアプリケーションが、コネクションプールから取得した接続を使用してクエリを実行しようとした場合を考えます。アプリケーションでその接続オブジェクトを使用しようとすると、接続が古くなっており既に無効になっていた場合、クライアントアプリケーションは開いている接続を介してクエリーデータを送信しようとし、例外が発生します。 クライアント側のアプリケーションが例外を捕捉し、TCP 接続が閉じられます。PostgreSQL サーバーはクライアント側の接続が閉じられたことを検出し、以下のようなエラーが返されます。</p><blockquote><p>WSAECONNRESET (10054) Connection reset by peer: An existing connection was forcibly closed by the remote host.<br>ここでいう「remote host(リモートホスト)」とは、Postgresサーバーではなくクライアントのことです。</p></blockquote><h3 id="詳細について"><a href="#詳細について" class="headerlink" title="詳細について"></a>詳細について</h3><p>何が問題を引き起こしているかを正確に理解するためには、問題が発生したときにクライアント側でネットワークトレースをキャプチャすることが有効です。ネットワークトレースは、NetMon、WireShark、Fiddlerなどの様々なアプリケーションでキャプチャすることができます。</p><p>Linuxクライアントを使用していて、上記のツールが動作しない場合、以下のコマンドのように手動でネットワークダンプを生成することができます。</p><blockquote><p>tshark -i any -n -b filesize:204800 -w <code>date +%y%m%d-%H:%M:%S</code>.pcap -b files:1000</p></blockquote><p>または</p><blockquote><p>tcpdump -i any -w <code>date +%y%m%d-%H:%M:%S</code>.pcap -G 300 -W 1000</p></blockquote><p>注：ネットワークキャプチャを有効にした場合、ディスク容量を監視し、容量不足にならないように必要に応じてファイルを削除してください。</p><h2 id="解決方法"><a href="#解決方法" class="headerlink" title="解決方法"></a>解決方法</h2><ul><li><p>Pgbouncerの使用<br>pgBouncerは、アプリケーションとデータベースの間に位置するコネクションプーラーです。データベースへの新しい接続が必要な場合、アプリケーションはコネクションプールから接続を取得し、それを再利用し続けます。一定の時間が経過すると、接続は解放されます。つまり、アプリケーションがデータベースへの接続を取得した後、一定時間以上使用しない場合、実際にはアイドル接続として扱われ、再利用されるため新たな接続が消費されません。<br>詳細については、以下でもご説明していますのでご参照ください<br><a href="https://techcommunity.microsoft.com/t5/azure-database-for-postgresql/not-all-postgres-connection-pooling-is-equal/ba-p/825717">Not all Postgres connection pooling is equal</a></p></li><li><p>過渡的なエラーを処理するために再試行ロジックを実装する<br>クラウド上でアプリケーションを設計・開発する場合、一過性のエラーが発生する可能性があるため、ベストプラクティスとしてリトライロジックを実装します。この場合、クライアントクエリを再試行することで、使用可能な接続を見つけることができます。詳しくはこちらをご覧ください。<br><a href="https://learn.microsoft.com/ja-jp/azure/postgresql/single-server/concepts-connectivity">Azure Database for PostgreSQL - Singlser Server の一時的な接続エラーに対処する</a></p></li><li><p>アイドル状態の接続を最小限にする<br>接続の管理は、PostgreSQLのユーザとの会話でよく出てくる話題です。PostgreSQLの接続はコストがかかります。アイドルでもアクティブでも、それぞれの接続は一定のメモリを消費します（1接続あたり10MB程度）。アイドル状態の接続とは、アプリケーションから接続を取得し、それを使用しないまま保持するものです。アプリケーションのコネクションプーラも、1つまたは複数のアイドル接続を消費することがあります。詳細については、以下を参照してください。<br><a href="https://techcommunity.microsoft.com/t5/azure-database-for-postgresql/connection-handling-best-practice-with-postgresql/ba-p/790883">Connection handling best practice with PostgreSQL</a></p></li></ul><p>statement_timeout と idle_in_transaction_session_timeout を適切に設定する方法については、以下を参照してください。<br><a href="https://www.craigkerstiens.com/2017/09/18/postgres-connection-management/">Tracking and Managing Your Postgres Connection</a></p><ul><li><p>アプリケーションからKeep-alive を送信する<br>接続が一定時間アクティブでない状況で、プールされた接続がアイドルのためタイムアウトしないようにすることができます。</p></li><li><p>アプリケーションのリソース使用率をチェックする<br>クライアント側でリソースの負荷が高い（CPUが高い、IOPSが高い、コンテキストスイッチが高い）と、速度が低下することがあります。この遅れにより、接続が長時間にわたって開かれ、最終的に接続が切断される可能性があります。</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;※本記事は &lt;a href=&quot;https://techcommunity.microsoft.com/t5/azure-database-for-postgresql/troubleshoot-postgresql-an-existing-connection-was-fo</summary>
      
    
    
    
    
    <category term="PostgreSQL" scheme="https://jp-ossdb.github.io/blog/tags/PostgreSQL/"/>
    
  </entry>
  
</feed>
